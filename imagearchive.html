<!doctype html>
<html lang="en" class="">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Closet Archives</title>
    <link rel="stylesheet" href="./resources/index.css"> <!--this links your HTML file to your CSS style sheet in resources folder-->
    <link rel="icon" type="image/x-icon" href="./resources/"> <!--In href="" after resources, type in your file name to link an image for your favicon-->
    <link rel="stylesheet" href="https://use.typekit.net/cle6pmv.css">
</head>

<body id="image-archive">

<h1>Closet Archives</h1>

<header>
    <div class="header" id="navigation-menu">     
<ul>
    <li><a href="index.html">Home</a></li>
    <li><a href="stories.html">Stories</a></li>
    <li><a href="imagearchive.html">Image Archive</a></li>
</ul>
    </div>
</header>


<p>THIS WILL HAVE MY IMAGES.</p>

<section>
  <p>Images:</p>
</section>

  <section class="grid">
       </section>
          

      
       <script>
console.log('JS is loaded');

document.addEventListener("touchstart", function() {}, true);

// Are.na's base API url
const api = 'https://api.are.na/v2/channels/';
const channel = 'thrifted-second-hand-clothing'; //add your channel name string in the url here here
const grid_el = document.querySelector('.grid');

// Track the current page and whether data is being fetched
let page = 1;
const perPage = 100;
let isFetching = false;
let moreDataAvailable = true;

// Function to fetch a single page of items
async function fetchItems(page, perPage) {
   const response = await fetch(`${api}${channel}/contents?direction=desc&per=${perPage}&page=${page}`);
   const data = await response.json();
   return data.contents;
}

// Function to render items to the grid
function renderItems(items) {
   items.forEach((item) => {
       let block_el = document.createElement('div');
       block_el.classList.add('blocks');

       if (item.class === 'Text') {
           block_el.innerHTML = item.content_html;
       } else if (item.class === 'Image') {
           block_el.innerHTML = `<img src="${item.image.display.url}">`;
           block_el.classList.add('image');
       }

       // Append block to document
       grid_el.appendChild(block_el);
   });
}

// Function to handle infinite scroll
async function handleScroll() {
   if (isFetching || !moreDataAvailable) return;

   // Check if the user scrolled near the bottom of the page
   const scrollTop = window.scrollY || document.documentElement.scrollTop;
   const windowHeight = window.innerHeight || document.documentElement.clientHeight;
   const documentHeight = document.documentElement.scrollHeight;

   if (scrollTop + windowHeight >= documentHeight - 100) {
       isFetching = true;
       console.log(`Fetching page ${page}...`);
      
       const items = await fetchItems(page, perPage);
       if (items.length > 0) {
           renderItems(items);
           page++;
       } else {
           moreDataAvailable = false; // No more data to fetch
       }

       isFetching = false;
   }
}

// Initial fetch for the first page
fetchItems(page, perPage).then((items) => {
   renderItems(items);
   page++;
});

// Attach the scroll event listener
window.addEventListener('scroll', handleScroll);

       </script>






   </body>
</html>






